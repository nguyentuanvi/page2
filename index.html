<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bible Verse by Emotion</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        /* background: linear-gradient(to bottom, #fdf6e3, #e5e5e5); */
        /*background: url('https://t3.ftcdn.net/jpg/01/82/36/22/360_F_182362279_mftijArjVNEa8ngWA8JN9hCome8zJTqw.jpg') no-repeat center center fixed;*/
        background: 293562-follow-your-own-light-sunset-wallpaper-beach-sunset-wallpaper.jpg;
        background-size: cover;
        min-height: 100vh;
        color: #333;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .header-image {
        width: 100%;
        max-height: 250px;
        object-fit: cover;
      }

      h1 {
        margin: 16px 0 10px;
        font-size: 16px;
        font-weight: bold;
      }

      h2 {
        font-size: 20px;
        margin-bottom: 12px;
      }

      #verse {
        margin: 16px;
        font-style: italic;
        font-size: 18px;
        max-width: 90%;
        background: rgba(255, 255, 255, 0.7);
        padding: 12px;
        border-radius: 10px;
      }

      .mood-buttons {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        max-width: 400px;
        margin-bottom: 40px;
      }

      .btn {
        padding: 12px 16px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        color: white;
        min-width: 120px;
        transition: transform 0.2s ease-in-out; /* Add transition for hover effect */
      }

      .btn:hover {
        transform: translateY(-3px); /* Lift button on hover */
      }

      .happy,
      .angry,
      .thankful,
      .hopeful,
      .sad,
      .troubled {
        background-color: #f4c542;
        color: #000;
      }

      /* Highlight button style */
      .selected {
        border: 2px solid #ffffff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body>
    <img
      src="https://img.tripi.vn/cdn-cgi/image/width=700,height=700/https://t3.ftcdn.net/jpg/01/82/36/22/360_F_182362279_mftijArjVNEa8ngWA8JN9hCome8zJTqw.jpg"
      class="header-image"
      alt="Jesus"
    />
    <h1>Bible Verses For The Moment</h1>

    <div id="verse">Loading verses...</div>
    <h2>READ ME WHEN</h2>
    <div class="mood-buttons">
      <button class="btn happy" data-emotion="happy">Happy</button>
      <button class="btn sad" data-emotion="sad">Sad</button>
      <button class="btn angry" data-emotion="angry">Angry</button>
      <button class="btn thankful" data-emotion="thankful">Thankful</button>
      <button class="btn hopeful" data-emotion="hopeful">Hopeful</button>
      <button class="btn troubled" data-emotion="troubled">Troubled</button>
    </div>

    <script>
      const SHEET_ID = '1BMBjTkjPA5KhpbZKWN3HctUeK8Z0A0G2pP4XX49wLdo';
      const GID = '725867898';
      const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&tq=SELECT%20A%2C%20B%2C%20C%2C%20D%2C%20E%2C%20F&gid=${GID}`;

      let versesData = {
        happy: [],
        sad: [],
        angry: [],
        thankful: [],
        hopeful: [],
        troubled: [],
      };

      const emotionColumnMap = {
        happy: 0, // Cột A
        sad: 1, // Cột B
        angry: 2, // Cột C
        thankful: 3, // Cột D
        hopeful: 4, // Cột E
        troubled: 5, // Cột F
      };

      const verseDisplay = document.getElementById('verse');
      const buttons = document.querySelectorAll('.mood-buttons .btn');

      async function fetchVerses() {
        verseDisplay.textContent = "Loading verses...";
        try {
          const response = await fetch(SHEET_URL);
          const text = await response.text();
          const jsonString = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
          const data = JSON.parse(jsonString);

          // Bắt đầu từ hàng thứ 2 (chỉ số 1) để bỏ qua tiêu đề
          const rows = data.table.rows.slice(1); 

          rows.forEach(row => {
            for (const emotion in emotionColumnMap) {
              const colIndex = emotionColumnMap[emotion];
              if (row.c[colIndex] && row.c[colIndex].v) {
                versesData[emotion].push(row.c[colIndex].v);
              }
            }
          });
          console.log("Verses loaded:", versesData);
          showVerse('happy');
          document.querySelector('.happy').classList.add('selected');

        } catch (error) {
          console.error("Error fetching verses:", error);
          verseDisplay.textContent = "Failed to load verses. Please check your sheet ID, column selection, and network connection.";
        }
      }

      function showVerse(emotion) {
        const pool = versesData[emotion];
        if (pool && pool.length > 0) {
          const random = pool[Math.floor(Math.random() * pool.length)];
          verseDisplay.textContent = random;
        } else {
          verseDisplay.textContent = `No verses available for ${emotion}.`;
        }

        buttons.forEach((button) => button.classList.remove('selected'));

        const selectedButton = document.querySelector(`.btn[data-emotion="${emotion}"]`);
        if (selectedButton) {
          selectedButton.classList.add('selected');
        }
      }

      buttons.forEach(button => {
        button.addEventListener('click', (event) => {
          const emotion = event.target.dataset.emotion;
          showVerse(emotion);
        });
      });

      fetchVerses();
    </script>
  </body>
</html>
